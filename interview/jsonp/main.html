<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <script>

        // let jsonp = (url, data = {}, callback = 'callback') => {
        //     // 1. js可以创建标签 document.createElment
        //     // 函数作用域 外界可以访问到呢？   window
        //     // 字符串拼接 准备好带有padding 的请求url
        //     let dataStr = url.indexOf('?') === -1 ? '?' : '&'
        //     // console.log(dataStr);
        //     for (let key in data) {
        //         dataStr += `${key}=${data[key]}&`;
        //     }
        //     dataStr += 'callback=' + callback

        //     // 构建script 
        //     let oScript = document.createElement('script');
        //     oScript.src = url + dataStr;
        //     document.body.appendChild(oScript)

        //     // window[callback] = (data) => {
        //     //     console.log(data);
        //     // }

        //     return new Promise((resolve,reject) =>{
        //         window[callback] = (data) => {
        //             try{
        //                 resolve(data)
        //             }
        //             catch(e){
        //                 reject(e)
        //             }
        //             finally{
        //                 oScript.parentNode.removeChild(oScript)
        //             }
        //         }
        //     })

        //     console.log(dataStr);
        // }
        // // 请使用json原理 封装 jsonp函数  不用为了远程资源 
        // //  避免 在get请求中加参数 函数 和 加入script标签
        // jsonp('https://photo.sina.cn/aj/index', {
        //     page: 1,
        //     cate: 'recommend'

        // })
        //     .then(response => {
        //         console.log(response,'-----then');
        //     })

        jsonp('http://localhost:3000',{
            a:1,
            callback=func
        })
        .then(response => {
            console.log(response,'---------');
        })
    </script>
</body>

</html>
